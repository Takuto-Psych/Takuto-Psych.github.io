<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://takutopsych.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://takutopsych.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://takutopsych.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://takutopsych.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://takutopsych.github.io/css/light.css' />
    <link rel="stylesheet" href='https://takutopsych.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://takutopsych.github.io/css/syntax.css' />
    <title>報酬感受性のパラメータをイジって予測誤差大きくなるか確認してみたよ - TakutoPsych Blog</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github.png'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="Qの上限が上がってるんやからそりゃ予測誤差deltaも上がるわな" />
<meta name="keywords"
  content=', ' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://takutopsych.github.io/post/2022-03-12-/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="報酬感受性のパラメータをイジって予測誤差大きくなるか確認してみたよ - TakutoPsych Blog" />
<meta name="twitter:description"
  content="Qの上限が上がってるんやからそりゃ予測誤差deltaも上がるわな" />
<meta name="twitter:site" content="https://takutopsych.github.io/" />
<meta name="twitter:creator" content="TakutoPsych" />
<meta name="twitter:image"
  content="https://takutopsych.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="報酬感受性のパラメータをイジって予測誤差大きくなるか確認してみたよ - TakutoPsych Blog">
<meta property="og:description"
  content="Qの上限が上がってるんやからそりゃ予測誤差deltaも上がるわな" />
<meta property="og:url" content="https://takutopsych.github.io/post/2022-03-12-/" />
<meta property="og:site_name" content="報酬感受性のパラメータをイジって予測誤差大きくなるか確認してみたよ" />
<meta property="og:image"
  content="https://takutopsych.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2022-03-12 00:00:00 &#43;0000 UTC" />









<script async src="https://www.googletagmanager.com/gtag/js?id=G-HJZ2YGN88R"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HJZ2YGN88R');
  
  gtag('config', 'UA-222698215-3');


</script>


<meta name="google-site-verification" content="ZTJLaWcJsPiyOc11H0OSIjk1bYevn3VcRp4FNnJVpuw" />
</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link " href="https://takutopsych.github.io/">
        <span style="margin-left: 8px;">
          TakutoPsych Blog
        </span>
      </a>
    </div>
    
    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://takutopsych.github.io/">
        
        <span style="margin-left: 8px;">
          TakutoPsych Blog
        </span>
      </a>
    </div>
    <div class="Header-item" style="margin-left: auto;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://takutopsych.github.io/">
                  <img class=" avatar-user"
                    src="https://takutopsych.github.io/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://takutopsych.github.io/">TakutoPsych</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://takutopsych.github.io/post/2022-03-12-/">報酬感受性のパラメータをイジって予測誤差大きくなるか確認してみたよ</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Sat, 12 Mar 2022 00:00:00 &#43;0000"
                    class="no-wrap">
                    Sat, 12 Mar 2022 00:00:00 &#43;0000</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Sat, 12 Mar 2022 17:23:33 &#43;0900"
                    class="no-wrap">
                    Sat, 12 Mar 2022 17:23:33 &#43;0900</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      4365 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/r">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      R
                    </a>
                    
                    <a class="muted-link mr-3" href="/tags/%E5%BC%B7%E5%8C%96%E5%AD%A6%E7%BF%92">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      強化学習
                    </a>
                    
                    <a class="muted-link mr-3" href="/tags/%E7%B5%B1%E8%A8%88">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      統計
                    </a>
                    
                    <a class="muted-link mr-3" href="/tags/%E5%8B%89%E5%BC%B7">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      勉強
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg">
<script src="https://takutopsych.github.io/post/2022-03-12-/index_files/header-attrs/header-attrs.js"></script>
<script src="https://takutopsych.github.io/post/2022-03-12-/index_files/htmlwidgets/htmlwidgets.js"></script>
<link href="https://takutopsych.github.io/post/2022-03-12-/index_files/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="https://takutopsych.github.io/post/2022-03-12-/index_files/datatables-binding/datatables.js"></script>
<script src="https://takutopsych.github.io/post/2022-03-12-/index_files/jquery/jquery-3.6.0.min.js"></script>
<link href="https://takutopsych.github.io/post/2022-03-12-/index_files/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="https://takutopsych.github.io/post/2022-03-12-/index_files/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="https://takutopsych.github.io/post/2022-03-12-/index_files/dt-core/js/jquery.dataTables.min.js"></script>
<link href="https://takutopsych.github.io/post/2022-03-12-/index_files/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
<script src="https://takutopsych.github.io/post/2022-03-12-/index_files/crosstalk/js/crosstalk.min.js"></script>


<div id="報酬感受性と報酬予測誤差" class="section level2">
<h2>報酬感受性と報酬予測誤差</h2>
<p><a href="">前回の記事</a>で、報酬感受性が高まると予測誤差が高まるという話をしました。んで、報酬感受性ρにオピオイドが関わるかもねって話をしました。</p>
<p>ただ、報酬感受性が高い個人の報酬予測誤差が高くなるという記述をしたのですが、本当かそれ？って自分の論理を疑問に思いました。てことで、Q学習式モデルのシミュレーションデータ作って、それぞれのパラメータをイジって、本当に報酬感受性が高いと、Q学習式において、報酬予測誤差が大きくなるのかを検証していきます。</p>
</div>
<div id="確率選択課題をコンピュータにやらせましょう" class="section level2">
<h2>確率選択課題をコンピュータにやらせましょう</h2>
<p>強化学習を人間にやらせるときには、2腕バンディット課題と呼ばれたり確率選択課題と呼ばれたりする課題を大抵使用します。</p>
<p>確率選択課題では、◯と△という刺激を参加者にに提示して◯もしくは△の選択をさせます。参加者が◯を選ぶと、80%で報酬のフィードバック、20%で報酬なしのフィードバックを得られます。一方△を選ぶと、確率を入れ替えて、20%で報酬のフィードバック、80%で報酬なしのフィードバックを得られます。課題によっては、報酬なしのフィードバックのところが罰のフィードバックになります。</p>
<p>以下の図1の実験図は修論の図を少し改変したものです。その図の学習セッションが上に書いたものです。修論では、罰ありに設定して、70%, 30%の刺激ペアAB、60%, 40%の刺激ペアCDになっています。投稿したら読んでくだしゃい。</p>
<div class="figure">
<img src="img/only_gain_probablistic_selection_task.001.jpeg" title="図1. 確率選択課題" alt="" />
<p class="caption">図1. 確率選択課題</p>
</div>
<p>今回は、刺激ペア多いとめんどくさいし、テストセッションに興味ないし、パラメータ多いとめんどくさいので、標準的な80%で報酬のフィードバック20%で報酬なしのフィードバックを得られる刺激Aと20%で報酬のフィードバック80%で報酬なしのフィードバックを得られる刺激Bのペアを利用してシミュレーションしていきます。</p>
<p>行動価値Qは以下2つの式で更新します。</p>
<p><span class="math display">\[
δ(t) = r(t) · ρ - Q_i(t)
\]</span></p>
<p><span class="math display">\[
Q_i(t+1) = Q_i(t) + α · δ(t)
\]</span></p>
<p>ただし、まあ当然ながら選択しなかった刺激jについての行動価値は、以下の式で維持して更新。</p>
<p><span class="math display">\[
Q_j(t+1) = Q_j(t)
\]</span></p>
<p>上記式では、tは試行数を意味します。全ての式において(t)になってるのは、t試行目のその値を意味します。(t+1)になってるのは、t+1試行目のその値を意味します。シミュレーション時には、最大試行数100にしときます。r(t)はt試行目のフィードバックを意味します。報酬時には1を、報酬なし時には0を符号化します。 お次はパラメータについて。δは、予測誤差を意味します。δは報酬予測誤差、ρは報酬感受性、あと、Q<sub>i</sub>は選択した刺激iの行動価値を意味します。</p>
<p>次は、行動価値を実際の行動選択にどのように使用するかを計算します。</p>
<p><span class="math display">\[
P_A(t) = \frac{1}{1 + exp( -β · (Q_A(t) - Q_B(t)))}
\]</span></p>
<p>実際に刺激を選択するときには、上記ソフトマックス関数を元に、βを1に固定した以下の式で、選択確率を算出。βとρをフリーパラメータにすると、識別不能わけわからなくなるので、βを1に固定します。</p>
<p><span class="math display">\[
P_A(t) = \frac{1}{1 + exp( - (Q_A(t) - Q_B(t)))}
\]</span></p>
<p>P<sub>A</sub>(t)は、t試行目の、Aの選択確率です。P<sub>B</sub>は1-P<sub>A</sub>で出せますし、上の関数の行動価値の場所交換でもよしです。</p>
<p>よし！式の説明終わり！</p>
<p>さて、シミュレーションデータを作っていきましょう。</p>
</div>
<div id="シミュレーションデータを作ります" class="section level2">
<h2>シミュレーションデータを作ります</h2>
<p>おまじないを言います。</p>
<pre class="r"><code>rm(list = ls())
library(ggplot2)
library(dplyr)</code></pre>
<pre><code>## 
##  次のパッケージを付け加えます: &#39;dplyr&#39;</code></pre>
<pre><code>##  以下のオブジェクトは &#39;package:stats&#39; からマスクされています: 
## 
##      filter, lag</code></pre>
<pre><code>##  以下のオブジェクトは &#39;package:base&#39; からマスクされています: 
## 
##      intersect, setdiff, setequal, union</code></pre>
<pre class="r"><code>library(tidyr)
library(htmlTable)</code></pre>
<div id="実験の試行数や刺激の性質を設定" class="section level3">
<h3>実験の試行数や刺激の性質を設定</h3>
<p>機械君にやってもらう、刺激選択の試行数と、選択刺激の報酬フィードバックの性質を設定しておきます。</p>
<pre class="r"><code>##　試行数について
trial &lt;- 100

## 選択刺激の報酬フィードバックの確率設定
#刺激Aについて
######報酬の確率を0.8に設定
A_probability &lt;- 0.8

#刺激Bについて
######報酬の確率を0.2に設定
B_probability &lt;- 0.2</code></pre>
</div>
<div id="パラメータチュニチュニします" class="section level3">
<h3>パラメータチュニチュニします</h3>
<p>まずはパラメータをチューニングしていきます。</p>
<pre class="r"><code>alpha_input &lt;- c(0.1, 0.5, 0.9)
rho_input &lt;- c(1, 5, 9)

alpha_length &lt;- length(alpha_input)

rho_length &lt;- length(rho_input)</code></pre>
<p>以上のR内の&lt;- を書き換えてあげたら、パラメータを調整できます。具体的には、「alpha &lt;- 〇〇」のところと、「rho &lt;- ◯◯」のところです。</p>
<p>今回は、αを0.1, 0.5, 0.9、ρを1, 5, 9で設定してあげます。</p>
<p>で、設定したパラメータの値の組み合わせ全部を行列にします。</p>
<pre class="r"><code>## 学習率alphaのパラメータ作成

alpha　&lt;- rep(alpha_input, each = rho_length)

## 感受性rhoのパラメータ設定
rho &lt;- rep(rho_input, times = alpha_length) 




## idを設定する
id &lt;- c(1:(alpha_length * rho_length))
  
###### alphaとrhoのセットを作る。
parameter_DF &lt;- cbind(id, alpha, rho) %&gt;% data.frame(.)</code></pre>
<p>以上でチュニチュニして、パラメータの行列というかデータフレームを作りました。</p>
<p>データフレームの中身はこんな感じです。αは0.1, 0.5, 0.9が存在します。それぞれのαに、ρは1, 5, 9が存在します。最終的に、3列3 × 3 (=9)行の配列というかデータフレーム。ついでに、各パラメータにidをつけときました。idは9種類あります。</p>
<pre class="r"><code>DT::datatable(parameter_DF)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],[1,2,3,4,5,6,7,8,9],[0.1,0.1,0.1,0.5,0.5,0.5,0.9,0.9,0.9],[1,5,9,1,5,9,1,5,9]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>alpha<\/th>\n      <th>rho<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>ついでに、各パラメータは100試行することにしているので、各行を100個リピートしておきます。</p>
<pre class="r"><code>ids &lt;- rep(id, each = trial)
alphas &lt;- rep(alpha, each = trial)
rhos &lt;- rep(rho, each = trial)

trials &lt;- rep(1:trial, times = alpha_length * rho_length)
##simulation_DFという名前でデータフレーム作っとく。
simulation_DF &lt;- cbind(ids, alphas, rhos, trials) %&gt;% data.frame(.)

##ついでに、simulation_DFにQ値と、刺激の選択確率(P_A)と、行動価値(Q_A, Q_B)、予測誤差(delta)と、選択行動の履歴(choice,Aを選んだ場合1、Bを選んだ場合2を符号化)と、選択刺激から得られたフィードバック(feedback,報酬時には1を罰時には-1を符号化)と、行動選択のログを付け足しておく。
##変数の意味(変数名,変数の符号化の補足説明)

simulation_DF &lt;- simulation_DF %&gt;%
  mutate(.,
         P_A = rep(
           0,
           times = alpha_length  * rho_length * trial
           ),
         Q_A = rep(
           0, 
           times = alpha_length * rho_length * trial
           ),
         
         Q_B = rep(
           0, 
           times = alpha_length * rho_length * trial
           ),
         
         delta = rep(
           0, 
           times = alpha_length * rho_length * trial  
           ),
         
         choice = rep(
           0, 
           times = alpha_length * rho_length * trial 
           ),
         
         feedback = rep(
           0, 
           times = alpha_length * rho_length * trial 
           ),
         
         )</code></pre>
</div>
<div id="シミュレーションの簡単な説明" class="section level3">
<h3>シミュレーションの簡単な説明</h3>
<p>半年くらい前に、<a href="r_tips_4.html">階層ベイズでQ学習頑張らねばと備忘録</a>書いていた時の、rスクリプトを参考にシミュレーションしていきます。</p>
<p>まずは、以下のソフトマックスのβを1に固定した式で、行動価値から計算した刺激選択の確率を計算します。</p>
<p><span class="math display">\[
P_A(t) = \frac{1}{1 + exp( - (Q_A(t) - Q_B(t)))}
\]</span></p>
<p>次に、選択した刺激に紐づいた確率的なフィードバックを与えます。これは、Aを選んだら80%で報酬を、残り20%で報酬なしを与え、Bを選んだら20%で報酬を、残り80%で報酬なしを与えます。</p>
<p>次に、以下のそれぞれの式で、今回得られた確率的なフィードバックに感受性を掛け合わせたエージェントにとってのその報酬あるいは罰の主観的な価値の大きさから行動価値を引いた予測誤差を以下の式で出します。</p>
<p><span class="math display">\[
δ(t) = r(t) · ρ - Q_i(t)
\]</span></p>
<p>最後に以下の式で、予測誤差を学習率で更新して強化学習をしていきます。</p>
<p><span class="math display">\[
Q_i(t+1) = Q_i(t) + α · δ(t)
\]</span></p>
<p>ただし、選択されなかった刺激jは、以下の式で維持更新されます。</p>
<p><span class="math display">\[
Q_j(t+1) = Q_j(t)
\]</span></p>
<p>上記の処理を、idごとに、for文で100試行分処理してあげます。なんかもっとスマートな方法ある気がしますが、僕は心理学科でR触ってる雑魚なのでこんなもんで許してくれ。</p>
<pre class="r"><code>##エージェントごとに分けていく。

for(n in id) {
  id_simulation_DF &lt;- simulation_DF %&gt;% filter(., ids == n)
  ###試行ごとにfor文
  for(t in 1:trial) {
    id_simulation_DF$P_A[t] &lt;- 
      1/
      (
        1 + exp( 
        -1 *(id_simulation_DF$Q_A[t] - id_simulation_DF$Q_B[t])
        )
      )
    ####提示された刺激の行動価値に応じた行動選択の確率を算出して、
    ####その確率に応じた行動選択をしていく。
    if( runif(1,0,1) &lt; id_simulation_DF$P_A[t] ) {
      ##runif(◯, △, □)は、[△ ~ □]範囲の乱数を◯個生成する。
      id_simulation_DF$choice[t] &lt;- 1
      id_simulation_DF$feedback[t] &lt;- runif(1,0,1) &lt; A_probability %&gt;% 
        as.numeric(.)
    }
    else{
      id_simulation_DF$choice[t] &lt;- 2
      id_simulation_DF$feedback[t] &lt;- runif(1,0,1) &lt; B_probability %&gt;% 
        as.numeric(.)
    }
    
    ###行動価値の更新
    if(t &lt; trial){
      ####Aを選択した場合
      if(id_simulation_DF$choice[t] == 1){
        id_simulation_DF$delta[t] &lt;- id_simulation_DF$feedback[t] * 
          rho[n] - id_simulation_DF$Q_A[t]
        id_simulation_DF$Q_A[t+1] &lt;- id_simulation_DF$Q_A[t] + 
            alpha[n] * id_simulation_DF$delta[t]
        id_simulation_DF$Q_B[t+1] &lt;- id_simulation_DF$Q_B[t]
      }
      #####Bを選択した場合
      else{
        id_simulation_DF$delta[t] &lt;- id_simulation_DF$feedback[t] * 
          rho[n] - id_simulation_DF$Q_B[t]
        id_simulation_DF$Q_B[t+1] &lt;- id_simulation_DF$Q_B[t] + 
            alpha[n] * id_simulation_DF$delta[t]
        id_simulation_DF$Q_A[t+1] &lt;- id_simulation_DF$Q_A[t]
      }
    }
    simulation_DF[( trial * (n-1) + 1 ) :( trial * n ), ] &lt;- id_simulation_DF
  }
}</code></pre>
</div>
</div>
<div id="シミュレートされたデータでいい感じの作図をば" class="section level2">
<h2>シミュレートされたデータでいい感じの作図をば</h2>
<div id="全データで分析" class="section level3">
<h3>全データで分析</h3>
<p>上でシミュレーションしたデータを元に作図をしていきましょう。 x軸に試行数を、y軸にδを、色の違いでρを、形の違いでαを表現した散布図を書きます。頑張れ、ggplot2::geom_point()!!!!</p>
<pre class="r"><code>all_rhos_color_point &lt;- simulation_DF %&gt;% 
  ggplot(
    aes(
      x = trials,
      y = delta,
      shape = factor(alphas),
      color = factor(rhos)
    )
  ) + 
  geom_point()

print(all_rhos_color_point)</code></pre>
<p><img src="https://takutopsych.github.io/post/2022-03-12-/index_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>色(α)がδの高さを予測するかの確認に、色と形を入れ替えてみます。</p>
<pre class="r"><code>all_alphas_color_point &lt;- simulation_DF %&gt;% 
  ggplot(
    aes(
      x = trials,
      y = delta,
      shape = factor(rhos),
      color = factor(alphas)
    )
  ) + 
  geom_point()

print(all_alphas_color_point)</code></pre>
<p><img src="https://takutopsych.github.io/post/2022-03-12-/index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>まあ、見て分かる通り、ρの方が、δの値の高さを予測してそうですね。</p>
<p>記述統計をとってみると、</p>
<pre class="r"><code>##mean
with(simulation_DF, tapply(delta, list(rhos, alphas), mean))</code></pre>
<pre><code>##         0.1        0.5        0.9
## 1 0.1063440 0.03023908 0.01211121
## 5 0.4018482 0.09915743 0.05560561
## 9 0.8458679 0.16593750 0.09999992</code></pre>
<p>おっと、δの平均値だけ見ると、ρの高さが、δの大きさを予測してなさそうですね。</p>
<p>ただ、図と合わせてみると、正の値であれ負の値であれδの絶対値の大きさに、ρが効きそうですね。絶対値の大きい正と絶対値の大きい負の値を足し合わせたから、0に近づいちゃったのかもしれません。</p>
<p>てことで、以下の処理。</p>
</div>
</div>
<div id="報酬が得られなかった試行を取り除く" class="section level2">
<h2>報酬が得られなかった試行を取り除く</h2>
<p>僕は報酬が得られた時に関心があるので、報酬なし時の試行を取り除いて作図と記述統計再度してみます。</p>
<pre class="r"><code>only_gain_trial_simulation_DF &lt;- simulation_DF %&gt;%
  filter(., feedback == 1)</code></pre>
<p>色がρ、形がαです。色(ρ)がδを予測してそうですね。</p>
<pre class="r"><code>only_gain_rhos_color_point &lt;- only_gain_trial_simulation_DF %&gt;% 
  ggplot(
    aes(
      x = trials,
      y = delta,
      shape = factor(alphas),
      color = factor(rhos)
    )
  ) + 
  geom_point()

print(only_gain_rhos_color_point)</code></pre>
<p><img src="https://takutopsych.github.io/post/2022-03-12-/index_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>色と形を入れ替えます。今度は、色(α)は、δを予測してる気配はないですね。</p>
<pre class="r"><code>only_gain_alphas_color_point &lt;- only_gain_trial_simulation_DF %&gt;% 
  ggplot(
    aes(
      x = trials,
      y = delta,
      shape = factor(rhos),
      color = factor(alphas)
    )
  ) + 
  geom_point()

print(only_gain_alphas_color_point)</code></pre>
<p><img src="https://takutopsych.github.io/post/2022-03-12-/index_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>ついでに記述統計。</p>
<pre class="r"><code>##mean
with(only_gain_trial_simulation_DF, tapply(delta, list(rhos, alphas), mean))</code></pre>
<pre><code>##         0.1      0.5       0.9
## 1 0.4169013 0.316427 0.2217453
## 5 1.5720608 1.183670 1.5822321
## 9 1.7323303 2.099103 2.3057660</code></pre>
<p>報酬が得られなかった試行を取り除いたら、つまりδが負になる試行を取り除いたら、全試行では陰に隠れていたρの強烈なδへのパワーが現れましたね。</p>
<p>報酬感受性ρがδの予測誤差を修飾していることが確認されました。動機づけを生み出すドパミンは、他のパラメータで修飾されているかもしれませんね。気持ちよさ(hedonic)を生み出すモルヒネがドパミンの修飾パラメータだと僕は思いました。まあ強化学習とかQ学習とか数理的な背景は置いておいても、報酬得られた時にその主観的な気持ちよさが大きくなれば、そりゃその行動の動機づけ高まりますよね、多分。そいえば、射精時の主観的な気持ちよさが、オピオイド拮抗薬を入れたら下がったり<span class="citation">(<a href="#ref-Murphy1990" role="doc-biblioref">Murphy et al. 1990</a>)</span>するんで、まあ報酬それ自体の気持ち良さの修飾にオピオイド効いているような気はします。強化学習の報酬の文脈とはズレるけども。</p>
<p>あと、すっごいどうでもいい後書きなんですけど、αを「あるふぁ」と打って変換で入力していたのですが、いっぱい「あるふぁ」を打っていたら、アルファタウリにF1頑張ってほしいなって思いました。すっごいどうでもいい後書き失礼しました。</p>
</div>
<div id="引用文献" class="section level2 unnumbered">
<h2>引用文献</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Murphy1990" class="csl-entry">
Murphy, Michael R., Stuart A. Checkley, Jonathan R. Seckl, and Stafford L. Lightman. 1990. <span>“<span class="nocase">Naloxone inhibits oxytocin release at orgasm in man</span>.”</span> <em>Journal of Clinical Endocrinology and Metabolism</em> 71 (4). <a href="https://doi.org/10.1210/jcem-71-4-1056">https://doi.org/10.1210/jcem-71-4-1056</a>.
</div>
</div>
</div>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://takutopsych.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://takutopsych.github.io/css/toc.css' />

<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='https://takutopsych.github.io/css/gitalk.css'>
<script src='https://takutopsych.github.io/js/gitalk.min.js'></script>
<script>
  const gitalk = new Gitalk({
    clientID: 'TakutoPsych',
    clientSecret: 'Your client secret',
    repo: 'LuvSia',
    owner: 'ventusoon',
    admin: ['ventusoon'],
    id: eval("location.pathname"), 
    distractionFreeMode: false 
  });
  (function() {
    gitalk.render('gitalk-container');
  })();
</script>


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://takutopsych.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://takutopsych.github.io/js/github-style.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
  integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
  integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
  integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
  onload="renderMathInElement(document.body);"></script>



</html>